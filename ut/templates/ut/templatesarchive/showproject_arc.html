{% extends 'base.html' %}

{% load render_table from django_tables2 %}

{% block content %}

{% load crispy_forms_tags %}
<div class="container-fluid">
<div class="col-md-12">

{% if Project %}
    <h3> Project {{ Project.Project }} </h3>
    <ul class="nav nav-tabs">
    {% for c in Project.Classes_m2m.all %}
        <li class="nav-item">
            <a class="nav-link
               {% if Class_id == c.id %}
                   active
               {% endif %}
               "
               href="{% url 'ut:instances' c.id 0 Project.id %}">{{ c.Class }}</a>
        </li>
    {% endfor %}
    </ul>
{% endif %}

  {% if filterform %}
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            Filter and Actions {{filter_desc}}
          </button>
        </h5>
      </div>

      <div id="collapseOne" class="collapse" aria-labelledby="headingOne">
        <div class="card-body">
              {% crispy filterform %}
        </div>
      </div>
    </div>
  {% endif %}




<!--
<div class="d-inline-flex p-2 bd-highlight" >
        <button class="btn btn-primary" type="submit">Filter</button>
        <button class="btn btn-primary" type="submit" formaction="{% url 'ut:instances' Class_id 1 %}">Save to xls</button>
</div>
-->
</div>
</div>

<div class="container-fluid">
<div class="col-md-12">

{% csrf_token %}

{% if table %}
   {% render_table table  %}
{% else %}
   'no such table'
{% endif %}

{% if Class_id %}
<input type="button" class="createinstance btn btn-primary" data-form-url="{% url 'ut:edit_instance' Class_id 0 %}" value="New Instance" />
<input type="button" class="btn btn-primary" id="LoadInstances" value="Load from File" />
{% endif %}
</div>
</div>

<div id="#injectmodalhere">
</div>

{% endblock %}
{% block javascript %}
<script>
$(document).ready(function() {
    $('#modal').on('submit'),function(el){
        alert('Modal submited')
    };
    $("#LoadInstances").modalForm({
        formURL: "{% url 'ut:loadinstances' Class_id %}"
    });

    var asyncSuccessMessage = [
          "<div ",
          "style='position:fixed;top:0;z-index:10000;width:100%;border-radius:0;' ",
          "class='alert alert-icon alert-success alert-dismissible fade show mb-0' role='alert'>",
          "Success: Instance was updated.",
          "<button type='button' class='close' data-dismiss='alert' aria-label='Close'>",
          "<span aria-hidden='true'>&times;</span>",
          "</button>",
          "</div>",
          "<script>",
          "$('.alert').fadeTo(2000, 500).slideUp(500, function () {$('.alert').slideUp(500).remove();});",
          "<\/script>"
    ].join("");

    function updateInstancesModalForm (){
        $(".viewinstance,.editinstance,.createinstance").each(function () {
            $(this).modalForm({
                modalID : '#modal',
                formURL: $(this).data('form-url'),
                asyncUpdate : false,
                asyncSettings :{
                    //closeOnSubmit : true,
                    //submitBtn : ".submit-btn",
                    //dataUrl: "{% url 'ut:update_instances_table' Class_id %}",
                    //dataElementId : "#class"+"{{ Class_id }}",
                    //dataKey : 'table',
                    //successMessage : asyncSuccessMessage,
                    //addModalFormFunction : updateInstancesModalForm,
                }
            });
        });
    }
    updateInstancesModalForm();

    flatpickr(".datetimeinput", {
            enableTime: true,
            enableSeconds: false,
            dateFormat: "Y-m-d H:i",
            allowInput : true,
    });
    flatpickr(".dateinput", {
            enableTime: false,
            allowInput : true,
            enableSeconds: false,
            dateFormat: "Y-m-d",
    });

});

</script>
{% endblock %}
